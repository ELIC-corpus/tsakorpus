option_settings:
  aws:elasticbeanstalk:application:environment:
    # these become ENV vars in your Flask app
    AWS_S3_BUCKET:        tsakorpus-data
    ES_ENDPOINT:          https://vpc-tsakorpus-jz4eotofkti72cv3sgtsdc3gna.us-east-1.es.amazonaws.com
    ES_PORT: "443"                  # or 9200 if you allowed http
    ES_USE_SSL: "true" 

packages:
  yum:
    python3-pip: []

commands:
  01_install_awscli:
    command: pip3 install --upgrade awscli

container_commands:
  01_sync_json:
    command: |
      aws s3 sync s3://$AWS_S3_BUCKET/corpus/json    /var/app/current/src_convertors/corpus/json
    leader_only: true

  02_sync_media:
    command: |
      aws s3 sync s3://$AWS_S3_BUCKET/corpus/media   /var/app/current/src_convertors/corpus/media
    leader_only: true
  
  03_install_requirements:
    command: pip3 install -r requirements.txt
    leader_only: true

  04_run_indexator:
    command: cd indexator && python3 indexator.py
    leader_only: true
